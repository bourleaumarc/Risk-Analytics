---
title: "Practical2.part3"
output: html_document
date: "2023-11-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, echo = FALSE, message = FALSE, warning=FALSE}
source(here::here("script/setup.R"))
```

```{r}

# Load necessary libraries
library(readr)
library(dplyr)
library(lubridate)

# Read in the data
night_max <- read_csv("nightmax.csv")  # Replace "nightmax.csv" with the actual file name
night_min <- read_csv("nightmin.csv")

# Subset the data for summer months (June to September)
summer_night_max <- night_max %>%
  filter(month(date) >= 6 & month(date) <= 9)
summer_night_min <- night_min %>%
  filter(month(date) >= 6 & month(date) <= 9)

```


```{r}
# Load necessary libraries
library(extRemes)

# Remove rows with missing values
summer_night_max <- na.omit(summer_night_max)

# Now, you can proceed with your analysis on the filtered data.


# Estimate threshold for declustering
threshold <- fevd(summer_night_max$night.max, threshold = "mean", data = summer_night_max)

# Decluster the data
declustered_data <- evd(threshold)

# Calculate the time between exceedances
time_between_events <- diff(declustered_data$time)

# You can then analyze the distribution of time between events to assess clustering.


```


```{r}
# Cluster test for winter maximum temperatures
cluster_test_winter_max <- tscluster(winter_night_max$Temperature, threshold = "mean")
print(cluster_test_winter_max)

```

```{r}
# Cluster test for summer minimum temperatures
cluster_test_summer_min <- tscluster(summer_night_min$Temperature, threshold = "mean")
print(cluster_test_summer_min)

```


```{r}
# Cluster test for winter minimum temperatures
cluster_test_winter_min <- tscluster(winter_night_min$Temperature, threshold = "mean")
print(cluster_test_winter_min)

```


```{r}
# Load necessary library for declustering
library(extRemes)

# Estimate threshold for declustering
threshold <- fevd(summer_night_max$Temperature, threshold = "mean", data = summer_night_max)

# Decluster the data
declustered_data <- evd(threshold)

# Plot the declustered data
plot(declustered_data)

```


```{r}
# Fit GPD to raw data
gpd_raw <- gpd(summer_night_max$Temperature, threshold = threshold, data = summer_night_max)

# Fit GPD to declustered data
gpd_declustered <- gpd(declustered_data, threshold = threshold, data = summer_night_max)

# Assess the quality of the fit for both raw and declustered data
par(mfrow = c(2, 2))
plot(gpd_raw)
plot(gpd_declustered)

```

